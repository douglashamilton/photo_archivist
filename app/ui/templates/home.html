{% extends "base.html" %}
{% from "_partials.html" import flash_message, loading_indicator %}

{% block title %}Home - Photo Archivist{% endblock %}

{% block content %}
<div class="bg-white rounded-lg shadow px-5 py-6 sm:px-6">
    {# Status Card #}
    <div class="mb-8 p-4 bg-gray-50 rounded-lg">
        <h2 class="text-lg font-semibold text-gray-900 mb-4">OneDrive Connection</h2>
        
        {% if user %}
        <div class="flex items-center text-green-700">
            <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            <span>Connected as {{ user.display_name }}</span>
        </div>
        
        <div class="mt-2 text-sm text-gray-600">
            Last sync: {{ last_sync.strftime('%Y-%m-%d %H:%M:%S') if last_sync else 'Never' }}
        </div>
        {% else %}
        <div class="flex items-center text-gray-700">
            <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <span>Not connected</span>
        </div>
        
        <div class="mt-4">
            <a href="/auth/login" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700">
                Connect with Microsoft Account
            </a>
        </div>
        {% endif %}
    </div>

    {# Sync Controls #}
    {% if user %}
    <div class="mb-8">
        <h2 class="text-lg font-semibold text-gray-900 mb-4">Sync Control</h2>
        
        <div id="sync-status">
            <button class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50"
                    hx-post="/api/sync/run"
                    hx-vals='{"mode": "manual"}'
                    hx-target="#sync-status"
                    hx-swap="innerHTML"
                    hx-indicator="#sync-indicator">
                Run Sync Now
            </button>
            
            <div id="sync-indicator" class="htmx-indicator ml-3 inline-flex items-center">
                <svg class="animate-spin h-5 w-5 text-gray-500 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span>Syncing...</span>
            </div>
        </div>
    </div>

    {# Stats #}
    <div>
        <h2 class="text-lg font-semibold text-gray-900 mb-4">Statistics</h2>
        
        <dl class="grid grid-cols-1 gap-5 sm:grid-cols-3">
            <div class="px-4 py-5 bg-gray-50 shadow rounded-lg overflow-hidden sm:p-6">
                <dt class="text-sm font-medium text-gray-500 truncate">Total Photos</dt>
                <dd class="mt-1 text-3xl font-semibold text-gray-900">{{ stats.total_photos }}</dd>
            </div>

            <div class="px-4 py-5 bg-gray-50 shadow rounded-lg overflow-hidden sm:p-6">
                <dt class="text-sm font-medium text-gray-500 truncate">Latest Shortlist</dt>
                <dd class="mt-1 text-3xl font-semibold text-gray-900">{{ stats.shortlist_count }}</dd>
            </div>

            <div class="px-4 py-5 bg-gray-50 shadow rounded-lg overflow-hidden sm:p-6">
                <dt class="text-sm font-medium text-gray-500 truncate">Next Scheduled Sync</dt>
                <dd class="mt-1 text-3xl font-semibold text-gray-900">{{ next_sync.strftime('%Y-%m-%d') if next_sync else 'Not set' }}</dd>
            </div>
        </dl>
    </div>
    {% endif %}
</div>
{% endblock %}